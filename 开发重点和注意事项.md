# 开发重点和注意事项

## 关键技术难点

### 1. 任务编排器复杂逻辑
#### 核心挑战
- **多并行循环管理**：一个步骤可能包含50个并行循环
- **内存限制**：Arduino内存有限，任务解析必须在电脑端完成
- **精度要求**：0.1s时间精度，确保任务执行准确性

#### 解决方案
- **后端统筹**：电脑后端像指挥50个乐手，跟踪每个循环状态
- **状态跟踪**：实时记录每个循环的重复次数和当前子步骤
- **瞬时控制**：Arduino专注处理瞬时设备控制（如同时打开50个泵）

#### 实现细节
```javascript
// 循环状态跟踪示例
{
  stepId: 1,
  parallelLoops: [
    {
      loopId: 1,
      currentIteration: 3,    // 当前第3次循环
      currentSubStep: 2,      // 当前执行第2个子步骤
      totalIterations: 10,    // 总共10次循环
      intervalMs: 500         // 循环间隔500ms
    }
  ]
}
```

### 2. WiFi连接稳定性
#### 稳定性要求
- **100小时连续工作**：不能出现连接中断
- **内存泄漏防护**：及时释放资源
- **错误恢复**：自动重连机制

#### 实现策略
- **连接监控**：定期检查WiFi连接状态
- **资源管理**：及时释放HTTP请求资源
- **重连机制**：连接断开时自动重建热点

### 3. 前端UI设计要求
#### 设计目标
- **超越Apple Inc.**：集现存世上百家之所长
- **一眼惊艳**：用户第一眼就被吸引
- **三端适配**：手机/平板/电脑完美适配

#### 技术实现
- **Tailwind CSS**：原子化CSS，快速构建精美界面
- **Framer Motion**：流畅动画效果
- **响应式设计**：完美适配各种屏幕尺寸

## 数据持久化要求

### 任务编排器数据保护
- **页面切换保护**：切换到日志或控制面板不丢失编辑内容
- **导出功能**：支持任务配置导出为文件
- **导入功能**：支持从文件导入任务配置
- **自动保存**：编辑过程中自动保存到本地存储

### 实现方案
```javascript
// 本地存储策略
localStorage.setItem('taskDraft', JSON.stringify(taskData));
// 页面加载时恢复
const savedTask = JSON.parse(localStorage.getItem('taskDraft'));
```

## 架构质量保证

### 代码架构检查点
- **文件大小**：TypeScript/JavaScript ≤200行
- **文件夹限制**：每层≤8个文件
- **模块职责**：单一职责原则
- **依赖关系**：避免循环依赖

### 代码质量监控
- **实时检查**：开发过程中持续监控代码质量
- **重构时机**：发现坏味道立即重构
- **架构评审**：定期评审整体架构设计

## 扩展性设计

### 可配置框架核心
- **板型兼容**：支持未来Arduino板型（UNO R5、Mega WiFi等）
- **用户信任**：用户填写引脚号，系统完全信任
- **模块化设计**：易于添加新设备类型

### 代码生成验证
- **语法检查**：生成的Arduino代码语法正确
- **编译验证**：确保生成的代码能够编译通过
- **运行测试**：实际烧录测试验证功能正确性
