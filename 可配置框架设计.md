# 可配置框架设计

## 设计目标
为后人提供可配置的设备控制框架，支持不同Arduino板型和设备配置。

## 元件配置系统
### 元件属性定义
- **设备类型**：泵/阀（支持PWM和Digital模式选择）
- **引脚号**：用户指定Arduino连接引脚
- **控制模式**：PWM模式 或 Digital模式
- **PWM频率**：默认490Hz，支持自定义频率
- **设备名称**：用户自定义显示名称

### 配置文件结构
```json
{
  "boardType": "Arduino UNO R4 WiFi",
  "devices": [
    {
      "id": "pump1",
      "name": "充气泵1",
      "type": "pump",
      "pin": 5,
      "mode": "pwm",
      "pwmFrequency": 490
    },
    {
      "id": "valve1", 
      "name": "电磁阀1",
      "type": "valve",
      "pin": 2,
      "mode": "digital"
    }
  ],
  "wifiConfig": {
    "ssid": "FishControl_WiFi",
    "password": "fish2025"
  }
}
```

## Arduino代码生成器
### 生成内容
- **WiFi热点配置**：根据配置生成WiFi热点代码
- **设备初始化**：根据元件配置生成pinMode设置
- **HTTP服务器**：生成接收控制命令的服务器代码
- **设备控制函数**：生成对应的PWM/Digital控制函数

### 代码模板结构
```cpp
// 自动生成的设备定义
const int DEVICE_PIN_1 = 5;    // 用户配置的引脚
const int DEVICE_PIN_2 = 2;    // 用户配置的引脚

// WiFi配置
const char* ssid = "FishControl_WiFi";
const char* password = "fish2025";

// 设备控制函数
void controlDevice(int deviceId, int value) {
  // 根据配置生成对应的控制逻辑
}
```

## 兼容性设计
### 板型适配
- 支持未来Arduino板型（UNO R5 WiFi、Mega WiFi等）
- 用户填写引脚号，系统信任用户配置
- 自动检测板型特性（如PWM引脚数量）

### 扩展性考虑
- 模块化设计，易于添加新设备类型
- 配置文件版本控制，向后兼容
- 插件式架构，支持第三方扩展

## 验证机制
### 配置验证
- 引脚冲突检测
- 设备类型与控制模式匹配检查
- PWM频率范围验证

### 代码验证
- 生成的Arduino代码语法检查
- 编译前预检查
- 运行时错误处理
